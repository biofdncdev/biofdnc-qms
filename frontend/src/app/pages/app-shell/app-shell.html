<div class="app-shell">
  <aside class="nav-rail">
    <button class="rail-item" *ngFor="let m of menus" [class.active]="selected() === m.key"
            mat-icon-button [matTooltip]="m.label"
            (mouseenter)="onRailMouseEnter(m.key)"
            (click)="onMainClick(m)">
      <mat-icon [fontIcon]="m.icon"></mat-icon>
      <span>{{m.label}}</span>
    </button>

    <div class="rail-spacer"></div>

    <div class="account">
      <!-- M3 pattern: long-press/hover shows tooltip; click toggles end drawer -->
      <button mat-icon-button matTooltip="Account" (click)="openAccountMenu()">
        <mat-icon>account_circle</mat-icon>
      </button>
    </div>
  </aside>

  <section class="content">
    <header class="topbar">
      <div class="brand">BIO-FD&C QMS</div>
    </header>

    <main class="viewport">
      <router-outlet></router-outlet>
    </main>
  </section>

  <!-- Left slide panel without backdrop; overlays right next to the nav rail -->
  <aside class="section-drawer" [class.open]="leftOpen" aria-label="Section menu">
    <div class="side-menu">
      <div class="side-title">{{ selected() | titlecase }}</div>
      <a class="side-link" *ngFor="let item of sectionMenu" [class.selected]="item.selected" (click)="onSubClick(item)">{{ item.label }}</a>
    </div>
  </aside>

  <!-- Account-only menu on right -->
  <mat-sidenav-container class="right-sidenav" hasBackdrop [style.visibility]="accountOpen ? 'visible' : 'hidden'">
    <mat-sidenav mode="over" position="end" [(opened)]="accountOpen">
      <div class="side-menu">
        <div class="side-title">계정</div>
        <a class="side-link" routerLink="/app/profile">로그인 프로필</a>
        <a class="side-link" *ngIf="isAdmin" routerLink="/app/admin/roles">사용자정보(관리자)</a>
        <a class="side-link logout" (click)="logout()">로그아웃</a>
      </div>
    </mat-sidenav>
  </mat-sidenav-container>
</div>
