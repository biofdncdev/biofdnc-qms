<div class="app-shell">
  <aside class="nav-rail">
    <button class="rail-item" mat-icon-button matTooltip="Menu" (click)="toggleLeftDrawer()">
      <mat-icon>{{ leftOpen ? 'menu_open' : 'menu' }}</mat-icon>
      <span>Menu</span>
    </button>
    <button class="rail-item" *ngFor="let m of menus" [class.active]="selected() === m.key"
            mat-icon-button [matTooltip]="m.label"
            (mouseenter)="onRailMouseEnter(m.key)"
            (click)="onMainClick(m)">
      <span class="icon-badge">
        <mat-icon [fontIcon]="m.icon"></mat-icon>
        <span class="badge" *ngIf="m.badge && m.badge > 0">{{ m.badge }}</span>
      </span>
      <span>{{m.label}}</span>
    </button>

    <div class="rail-spacer"></div>

    <div class="account">
      <button mat-icon-button matTooltip="Account" (click)="openAccountList()">
        <mat-icon>account_circle</mat-icon>
      </button>
    </div>
  </aside>

  <section class="content" [class.drawer-open]="leftOpen" [class.compact]="drawerCompact" (mouseenter)="onContentMouseEnter()">
    <header class="topbar">
      <div class="brand">BIO-FD&C QMS</div>
      <div class="tabbar" *ngIf="tabs.length" #tabbarRef>
        <button class="close-all" title="모든 탭 닫기" (click)="closeAllTabs()">× 모두닫기</button>
        <div class="tab" *ngFor="let t of tabs | slice:0:visibleCount; index as i" [class.active]="i===activeTabIndex" [class.dragover]="i===dragOverIndex"
             draggable="true" (dragstart)="onTabDragStart($event,i)" (dragover)="onTabDragOver($event,i)" (dragleave)="onTabDragLeave()" (drop)="onTabDrop($event,i)">
          <button class="tab-btn" (click)="activateTab(i)">{{ t.title }}</button>
          <button class="tab-close" (click)="closeTab(i)">×</button>
        </div>
        <div class="overflow" *ngIf="tabs.length > visibleCount">
          <button class="overflow-btn" (click)="toggleOverflow()" title="More tabs">⋯</button>
          <div class="overflow-menu" *ngIf="overflowOpen">
            <a class="overflow-item" *ngFor="let t of tabs | slice:visibleCount" (click)="activateTabByPath(t.path)">{{ t.title }}</a>
          </div>
        </div>
      </div>
    </header>

    <main class="viewport">
      <router-outlet></router-outlet>
    </main>
  </section>

  <!-- Left slide panel without backdrop; overlays right next to the nav rail -->
  <aside class="section-drawer" [class.open]="leftOpen" [class.compact]="drawerCompact" aria-label="Section menu">
    <div class="side-menu">
      <div class="side-title">{{ selected() | titlecase }}</div>
      <a class="side-link" *ngFor="let item of sectionMenu"
         [class.selected]="item.selected"
         (mousemove)="onHover($event)"
         (click)="onSubClick(item)">{{ item.label }}</a>
    </div>
  </aside>

  <!-- right sidenav removed; account opens in left drawer like others -->
</div>
